# booking-service/Dockerfile

# Stage 1: –°–±–æ—Ä–∫–∞ JAR
FROM maven:3.9.5-eclipse-temurin-17 AS builder

RUN echo "üî• –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Dockerfile.prod"

RUN apt-get update && apt-get install -y default-mysql-client

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
WORKDIR /app

COPY pom.xml .
COPY src ./src

RUN mvn clean package -DskipTests


# Stage 2: —Å–æ–∑–¥–∞–µ–º –ª–µ–≥–∫–∏–π –æ–±—Ä–∞–∑
FROM eclipse-temurin:17-jdk-alpine

WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª jar –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
COPY --from=builder /app/target/bookings-service-0.0.1-SNAPSHOT.jar app.jar

# –ó–∞–ø—É—Å–∫–∞–µ–º Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
ENTRYPOINT ["java", "-jar", "app.jar"]